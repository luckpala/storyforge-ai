# StoryForge 数据服务器使用说明

## 📋 概述

数据服务器是一个本地 Node.js 服务，用于在应用安装目录的 `data/` 文件夹中保存所有数据。这样可以实现：

- ✅ **跨浏览器共享**：所有浏览器访问同一个数据源
- ✅ **数据持久化**：数据保存在硬盘上，不依赖浏览器存储
- ✅ **自动同步**：应用自动保存到数据服务器
- ✅ **无需手动选择目录**：数据自动保存在应用目录下

## 🚀 快速开始

### 方法1：使用启动脚本（推荐）

1. **启动数据服务器和应用**：
   ```
   启动应用和数据服务器.bat
   ```
   这会自动启动数据服务器（后台）和开发服务器。

2. **仅启动数据服务器**：
   ```
   启动数据服务器.bat
   ```

### 方法2：手动启动

1. **启动数据服务器**：
   ```bash
   node data-server.js
   ```

2. **在另一个终端启动应用**：
   ```bash
   npm run dev
   ```

## 📁 数据存储位置

所有数据保存在应用目录下的 `data/` 文件夹：

```
storyforge-ai/
├── data/
│   ├── sessions.json      # 所有会话和故事数据
│   ├── settings.json      # API配置和应用设置
│   └── quickPrompts.json  # 快捷提示词
├── data-server.js         # 数据服务器
└── ...
```

## 🔄 工作原理

1. **数据服务器**运行在 `http://127.0.0.1:8765`
2. **应用启动时**：
   - 首先尝试连接数据服务器
   - 如果可用，从服务器加载数据
   - 如果不可用，回退到 localStorage
3. **数据保存时**：
   - 优先保存到数据服务器
   - 同时保存到 localStorage（作为备份）

## ⚙️ 配置

数据服务器默认配置：
- **端口**：8765
- **地址**：127.0.0.1（仅本地访问）
- **数据目录**：`应用目录/data/`

如需修改，请编辑 `data-server.js` 文件。

## 🛠️ 故障排除

### 问题1：数据服务器无法启动

**检查**：
1. 是否已安装 Node.js
2. 端口 8765 是否被占用
3. 查看控制台错误信息

**解决**：
```bash
# 检查端口占用
netstat -ano | findstr ":8765"

# 如果被占用，结束进程或修改 data-server.js 中的端口号
```

### 问题2：应用无法连接到数据服务器

**检查**：
1. 数据服务器是否正在运行
2. 浏览器控制台是否有错误
3. 防火墙是否阻止了连接

**解决**：
- 确保数据服务器已启动
- 检查浏览器控制台的网络请求
- 尝试手动访问 `http://127.0.0.1:8765/api/health`

### 问题3：数据没有保存

**检查**：
1. 数据服务器是否运行
2. `data/` 文件夹是否存在
3. 是否有写入权限

**解决**：
- 确保数据服务器正在运行
- 检查 `data/` 文件夹权限
- 查看数据服务器控制台的错误信息

## 📝 注意事项

1. **数据服务器必须运行**：如果数据服务器未运行，应用会回退到 localStorage，但数据不会跨浏览器共享。

2. **首次使用**：首次启动时，`data/` 文件夹会自动创建。

3. **数据备份**：建议定期备份 `data/` 文件夹。

4. **多实例**：如果同时运行多个应用实例，它们会共享同一个数据源。

5. **浏览器兼容性**：所有现代浏览器都支持，因为使用标准的 HTTP API。

## 🔐 安全性

- 数据服务器**仅监听本地地址**（127.0.0.1），不会暴露到网络
- 数据存储在本地文件系统，不会上传到任何服务器
- 所有数据都是明文 JSON，便于备份和迁移

## 💡 优势对比

### 使用数据服务器（推荐）
- ✅ 跨浏览器共享数据
- ✅ 数据保存在硬盘上
- ✅ 不依赖浏览器存储限制
- ✅ 易于备份和迁移

### 仅使用 localStorage
- ❌ 每个浏览器独立存储
- ❌ 清除浏览器数据会丢失
- ❌ 有存储大小限制
- ❌ 无法跨浏览器共享

## 🎯 最佳实践

1. **启动顺序**：先启动数据服务器，再启动应用
2. **定期备份**：定期复制 `data/` 文件夹到安全位置
3. **版本控制**：可以将 `data/` 文件夹加入 `.gitignore`（如果使用 Git）
4. **多设备**：如果需要多设备同步，可以使用云盘同步 `data/` 文件夹








































